{% extends "base.html" %}
{% load humanize %}

{% block title %}{{ author.name }}{% endblock %}

{% block content %}
<div class="container mt-5">
    <nav aria-label="breadcrumb" class="mb-4">
        <ol class="breadcrumb">
            <li class="breadcrumb-item">
                <a href="{% url 'authors:index' %}" class="text-primary">
                    <i class="bi bi-people me-1"></i>Authors
                </a>
            </li>
            <li class="breadcrumb-item active text-light" aria-current="page">{{ author.name }}</li>
        </ol>
    </nav>

    <div class="card bg-dark border-secondary">
        <div class="card-header border-secondary p-4">
            <div class="d-flex align-items-center">
                <div class="flex-shrink-0">
                    {% if author.photo %}
                        <img src="{{ author.photo.url }}" alt="{{ author.name }}" class="rounded-circle" style="width: 80px; height: 80px; object-fit: cover;">
                    {% else %}
                        <div class="rounded-circle bg-primary bg-opacity-15 p-3">
                            <i class="bi bi-person-circle text-primary fs-3"></i>
                        </div>
                    {% endif %}
                </div>
                <div class="flex-grow-1 ms-3">
                    <h1 class="h2 mb-1 text-light">{{ author.name }}</h1>
                    <p class="text-secondary mb-0">
                        <i class="bi bi-geo-alt me-2"></i>{{ author.country }}
                    </p>
                </div>
            </div>
        </div>

        <div class="card-body p-4">
            <div class="row g-4">
                <div class="col-md-8">
                    {% if author.description %}
                    <div class="mb-4">
                        <h3 class="h5 text-light mb-3">About the Author</h3>
                        <p class="text-secondary mb-0">{{ author.description|linebreaksbr }}</p>
                    </div>
                    {% endif %}
                </div>

                <div class="col-md-4">
                    <div class="card bg-dark border-secondary h-100">
                        <div class="card-body">
                            <h3 class="h5 text-light mb-4">Author Details</h3>
                            
                            <div class="d-flex align-items-center mb-3">
                                <div class="badge bg-primary bg-opacity-10 text-primary me-2">
                                    <i class="bi bi-book"></i>
                                </div>
                                <div>
                                    <div class="text-secondary small">Published Books</div>
                                    <div class="text-light">{{ author.books_count }}</div>
                                </div>
                            </div>

                            <div class="d-flex align-items-center mb-3">
                                <div class="badge bg-primary bg-opacity-10 text-primary me-2">
                                    <i class="bi bi-graph-up"></i>
                                </div>
                                <div>
                                    <div class="text-secondary small">Total Sales</div>
                                    <div class="text-light">{{ author.total_sales|intcomma }}</div>
                                </div>
                            </div>

                            {% if author.date_of_birth %}
                            <div class="d-flex align-items-center">
                                <div class="badge bg-primary bg-opacity-10 text-primary me-2">
                                    <i class="bi bi-calendar"></i>
                                </div>
                                <div>
                                    <div class="text-secondary small">Date of Birth</div>
                                    <div class="text-light">{{ author.date_of_birth|date:"d/m/Y" }}</div>
                                </div>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>

            <div class="mt-4 pt-4 border-top border-secondary">
                <div class="d-flex gap-2">
                    <a href="{% url 'authors:index' %}" class="btn btn-outline-light">
                        <i class="bi bi-arrow-left me-2"></i>Back to Authors
                    </a>

                    {% if user.is_authenticated %}
                        <a href="{% url 'authors:update' author.id %}" class="btn btn-warning">
                            <i class="bi bi-pencil me-2"></i>Edit Author
                        </a>
                        <button type="button" class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#deleteAuthorModal">
                            <i class="bi bi-trash me-2"></i>Delete
                        </button>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    {% if user.is_authenticated %}
    <div class="modal fade" id="deleteAuthorModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content bg-dark">
                <div class="modal-header border-secondary">
                    <h5 class="modal-title text-light">Delete Author</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body text-secondary">
                    Are you sure you want to delete this author? This action cannot be undone and will remove all associated data.
                </div>
                <div class="modal-footer border-secondary">
                    <button type="button" class="btn btn-outline-light" data-bs-dismiss="modal">Cancel</button>
                    <form method="post" action="{% url 'authors:delete' author.id %}" class="d-inline">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-danger">
                            <i class="bi bi-trash me-2"></i>Delete Author
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <style>
        .breadcrumb-item + .breadcrumb-item::before {
            color: var(--text-muted);
        }
        
        .breadcrumb-item.active {
            color: var(--text-primary);
        }

        .badge {
            font-weight: 500;
        }

        .badge.bg-primary.bg-opacity-10 {
            background-color: rgba(var(--primary-rgb), 0.1) !important;
            border: 1px solid rgba(var(--primary-rgb), 0.2);
            padding: 0.75rem;
        }

        .modal-backdrop.show {
            opacity: 0.8;
        }

        .btn:focus {
            box-shadow: 0 0 0 0.25rem rgba(var(--primary-rgb), 0.25);
        }

        .btn-outline-light:hover {
            background-color: var(--bg-accent);
            border-color: var(--text-primary);
            color: var(--text-primary);
        }
    </style>
{% endblock %}
